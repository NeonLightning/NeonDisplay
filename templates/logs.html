<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="{{ url_for('static', filename=ui_config.css_file) }}">
    <title>NeonDisplay Logs</title>
    <style>
        * {
            font-family: var(--font-primary); 
        }
        body {
            margin: 0;
            padding: 20px;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }
        .container {
            max-width: 100%;
            margin: 0;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: var(--bg-secondary);
            border-radius: 8px;
            border: 2px solid var(--border-color);
        }
        .controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        input, button, select {
            padding: 8px 12px;
            border: 2px solid var(--border-color);
            border-radius: 4px;
            background: var(--bg-tertiary);
            color: var(--text-primary);
            transition: all 0.3s ease;
        }
        button {
            font-family: var(--font-bold);
            background: var(--accent-color);
            border: 2px solid var(--border-color);
            cursor: pointer;
            color: var(--text-on-dark);
            font-weight: bold;
        }
        button:hover {
            background: var(--accent-hover);
            transform: translateY(-2px);
        }
        .log-container {
            background: var(--log-bg);
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            white-space: pre-wrap;
            max-height: 70vh;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
        }
        .log-line {
            margin: 2px 0;
            line-height: 1.4;
        }
        .log-error { color: var(--error-border); }
        .log-warning { color: var(--warning-border); }
        .log-info { color: var(--info-border); }
        .log-success { color: var(--success-border); }
        .log-debug { color: var(--text-secondary); }
        .theme-toggle {
            font-family: var(--font-bold);
            background: var(--accent-color);
            color: var(--text-on-dark);
            border: 2px solid var(--border-color);
            padding: 8px 12px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }
        .theme-toggle:hover {
            background: var(--accent-hover);
        }
    </style>
    </style>
</head>
<body data-theme="{{ current_theme }}">
    <div class="container">
        <div class="header">
            <h2>NeonDisplay Log Viewer</h2>
            <div class="controls">
                <form id="linesForm" method="GET" style="display: flex; gap: 10px; align-items: center;">
                    <label for="lines">Lines to show:</label>
                    <input type="number" id="lines" name="lines" value="{{ lines }}" min="10" max="10000" style="width: 80px;">
                    <button type="submit">Update</button>
                </form>
                <button onclick="toggleLive()" id="liveBtn">‚ñ∂Ô∏è Start Live</button>
                <button onclick="location.href='/'">‚Üê Back to Main</button>
                <button onclick="clearLogs()">‚ñ† Clear Logs</button>
                <button onclick="clearBackups()" id="clearBackupsBtn">‚ñ† Clear Backups: <span id="backupCount">{{ backup_count }}</span> files</button>
                <button class="theme-toggle" onclick="toggleTheme()" id="themeBtn">
                    {{ '‚òÄ' if current_theme == 'dark' else '‚òæ' }}
                </button>
            </div>
        </div>
        <div class="log-container" id="logContent">
{{ log_content }}
        </div>
    </div>
    <script>
        let liveUpdate = false;
        let updateInterval;
        let currentTheme = '{{ current_theme }}';
        function toggleTheme() {
            const currentTheme = document.body.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            document.body.setAttribute('data-theme', newTheme);
            const btn = document.getElementById('themeBtn');
            btn.innerHTML = newTheme === 'dark' ? '‚òÄ' : '‚òæ';
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = '/toggle_theme';
            const themeInput = document.createElement('input');
            themeInput.type = 'hidden';
            themeInput.name = 'theme';
            themeInput.value = newTheme;
            form.appendChild(themeInput);
            document.body.appendChild(form);
            form.submit();
        }
        function toggleLive() {
            liveUpdate = !liveUpdate;
            const btn = document.getElementById('liveBtn');
            if (liveUpdate) {
                btn.innerHTML = '‚è∏Ô∏è Stop Live';
                startLiveUpdates();
            } else {
                btn.innerHTML = '‚ñ∂Ô∏è Start Live';
                stopLiveUpdates();
            }
        }
        function startLiveUpdates() {
            const lines = document.getElementById('lines').value;
            updateInterval = setInterval(() => {
                fetch(`/view_logs?lines=${lines}&live=true`)
                    .then(response => response.text())
                    .then(data => {
                        document.getElementById('logContent').innerText = data;
                        colorCodeLogs();
                        scrollToBottom();
                    });
            }, 2000);
        }
        function stopLiveUpdates() {
            if (updateInterval) {
                clearInterval(updateInterval);
            }
        }
        function scrollToBottom() {
            const logContainer = document.getElementById('logContent');
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        function clearLogs() {
            if (confirm('Are you sure you want to clear the current log?')) {
                fetch('/clear_logs', { 
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: 'clear_option=current'
                })
                .then(() => {
                    location.reload();
                });
            }
        }
        function clearBackups() {
            if (confirm('Are you sure you want to clear ALL backup logs? This cannot be undone.')) {
                fetch('/clear_logs', { 
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: 'clear_option=all'
                })
                .then(response => response.text())
                .then(message => {
                    alert(message);
                    location.reload();
                })
                .catch(error => {
                    alert('Error clearing backups: ' + error);
                });
            }
        }
        function colorCodeLogs() {
            const container = document.getElementById('logContent');
            const lines = container.innerText.split('\n');
            let coloredHTML = '';
            lines.forEach(line => {
                let cssClass = 'log-line';
                if (line.includes('ERROR') || line.toLowerCase().includes('error')) {
                    cssClass += ' log-error';
                } else if (line.includes('WARNING') || line.toLowerCase().includes('warning')) {
                    cssClass += ' log-warning';
                } else if (line.includes('INFO') || line.includes('üìç') || line.includes('üîç') || line.toLowerCase().includes('info')) {
                    cssClass += ' log-info';
                } else if (line.includes('SUCCESS') || line.toLowerCase().includes('success')) {
                    cssClass += ' log-success';
                } else if (line.includes('DEBUG') || line.toLowerCase().includes('debug')) {
                    cssClass += ' log-debug';
                }
                coloredHTML += `<div class="${cssClass}">${line}</div>`;
            });
            container.innerHTML = coloredHTML;
        }
        colorCodeLogs();
        scrollToBottom();
        document.getElementById('linesForm').addEventListener('submit', function(e) {
            const input = document.createElement('input');
            input.type = 'hidden';
            input.name = 'theme';
            input.value = currentTheme;
            this.appendChild(input);
        });
    </script>
</body>
</html>